FROM webdevops/php-nginx:8.2-alpine

ENV WEB_DOCUMENT_ROOT=/app/public

WORKDIR /app

COPY . .

RUN composer install --no-interaction --optimize-autoloader --no-dev

RUN cp .env.example .env

RUN php artisan key:generate

RUN --mount=type=secret,id=DB_PASSWORD cat /run/secrets/DB_PASSWORD >> .env

RUN php artisan optimize

RUN chown -R application:application .
